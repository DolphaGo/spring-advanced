- [예제 프로젝트 만들기](#예제-프로젝트-만들기)
  - [V1](#v1)


---

# 예제 프로젝트 만들기

## V1

- Repository

```java
public interface OrderRepositoryV1 {
    void save(String itemId);
}
```

```java
public class OrderRepositoryV1Impl implements OrderRepositoryV1 {
    @Override
    public void save(final String itemId) {
        // 저장 로직
        if (itemId.equals("ex")) {
            throw new IllegalStateException("예외 발생!");
        }
        sleep(1000);
    }

    private void sleep(final int millis) {
        try {
            Thread.sleep(millis);
        } catch (InterruptedException e) {
            e.printStackTrace();
        }
    }
}
```

- Service

```java
public interface OrderServiceV1 {
    void orderItem(String itemId);
}
```

```java
public class OrderServiceV1Impl implements OrderServiceV1 {

    private final OrderRepositoryV1 orderRepository;

    public OrderServiceV1Impl(final OrderRepositoryV1 orderRepository) {
        this.orderRepository = orderRepository;
    }

    @Override
    public void orderItem(final String itemId) {
        orderRepository.save(itemId);
    }
}
```

- Controller

```java
@RequestMapping // 스프링은 @Controller 또는 @RequestMapping 이 있어야 스프링 컨트롤러로 인식한다.
@ResponseBody
public interface OrderControllerV1 {

    // Java 버전에 따라서 컨트롤러 클래스 단에서는 없어도 되는 어노테이션인 @RequestParam이 인터페이스 내부에는 @RequestParam 같은 것을 인식 못할 때가 있다.
    // 그래서 꼭 명시해주자.
    @GetMapping("/v1/request")
    String request(@RequestParam("itemId") String itemId);

    @GetMapping("/v1/no-log")
    String noLog();
}
```

```java
public class OrderControllerV1Impl implements OrderControllerV1 {

    private final OrderServiceV1 orderService;

    public OrderControllerV1Impl(final OrderServiceV1 orderService) {
        this.orderService = orderService;
    }

    @Override
    public String request(final String itemId) {
        orderService.orderItem(itemId);
        return "ok";
    }

    @Override
    public String noLog() {
        return "ok";
    }
}
```

- Bean 수동 등록

```java
@Configuration
public class AppV1Config {

    @Bean
    public OrderControllerV1 orderControllerV1() {
        return new OrderControllerV1Impl(orderServiceV1());
    }

    @Bean
    public OrderServiceV1 orderServiceV1() {
        return new OrderServiceV1Impl(orderRepositoryV1());
    }

    @Bean
    public OrderRepositoryV1 orderRepositoryV1() {
        return new OrderRepositoryV1Impl();
    }
}
```

- SpringApplication main

```java
@Import(AppV1Config.class)
@SpringBootApplication(scanBasePackages = "hello.proxy.app") //주의
public class ProxyApplication {

	public static void main(String[] args) {
		SpringApplication.run(ProxyApplication.class, args);
	}

}
```

- `@Import(AppV1Config.class)`
  - 클래스를 스프링 빈으로 등록한다.
  - 여기서는 `AppV1Config.class` 를 스프링 빈으로 등록한다.
  - 일반적으로 `@Configuration`같은 설정 파일을 등록할 때 사용하지만, 스프링 빈을 등록할 때도 있다.

- `@SpringBootApplication(scanBasePackages = "hello.proxy.app")`
  - 일부러 예제를 위해(버전을 V2, V3로 올라갈 것이라서) Config를 컴포넌트 스캔의 대상으로 두지 않도록 하려고 했던 것이다.


`@Configuration`은 내부에 `@Component` 애노테이션을 포함하고 있어서 컴포넌트 스캔의 대상이 된다. 따라서 컴포넌트 스캔에 의해 `hello.proxy.config`위치의 설정 파일들이 스프링 빈으로 자동 등록되지 않도록 컴포넌트 스캔의 시작 위치를 지정한 것이다(scanBasePackages)